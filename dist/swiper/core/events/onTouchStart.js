import{getWindow,getDocument}from"ssr-window";import $ from"../../shared/dom.js";import{now}from"../../shared/utils.js";function closestElement(t,e=this){return function e(o){return o&&o!==getDocument()&&o!==getWindow()?(o.assignedSlot&&(o=o.assignedSlot),o.closest(t)||e(o.getRootNode().host)):null}(e)}export default function onTouchStart(t){const e=this,o=getDocument(),n=getWindow(),i=e.touchEventsData,{params:r,touches:s,enabled:a}=e;if(!a)return;if(e.animating&&r.preventInteractionOnTransition)return;!e.animating&&r.cssMode&&r.loop&&e.loopFix();let l=t;l.originalEvent&&(l=l.originalEvent);let c=$(l.target);if("wrapper"===r.touchEventsTarget&&!c.closest(e.wrapperEl).length)return;if(i.isTouchEvent="touchstart"===l.type,!i.isTouchEvent&&"which"in l&&3===l.which)return;if(!i.isTouchEvent&&"button"in l&&l.button>0)return;if(i.isTouched&&i.isMoved)return;!!r.noSwipingClass&&""!==r.noSwipingClass&&l.target&&l.target.shadowRoot&&t.path&&t.path[0]&&(c=$(t.path[0]));const u=r.noSwipingSelector?r.noSwipingSelector:`.${r.noSwipingClass}`,h=!(!l.target||!l.target.shadowRoot);if(r.noSwiping&&(h?closestElement(u,l.target):c.closest(u)[0]))return void(e.allowClick=!0);if(r.swipeHandler&&!c.closest(r.swipeHandler)[0])return;s.currentX="touchstart"===l.type?l.targetTouches[0].pageX:l.pageX,s.currentY="touchstart"===l.type?l.targetTouches[0].pageY:l.pageY;const g=s.currentX,p=s.currentY,d=r.edgeSwipeDetection||r.iOSEdgeSwipeDetection,w=r.edgeSwipeThreshold||r.iOSEdgeSwipeThreshold;if(d&&(g<=w||g>=n.innerWidth-w)){if("prevent"!==d)return;t.preventDefault()}if(Object.assign(i,{isTouched:!0,isMoved:!1,allowTouchCallbacks:!0,isScrolling:void 0,startMoving:void 0}),s.startX=g,s.startY=p,i.touchStartTime=now(),e.allowClick=!0,e.updateSize(),e.swipeDirection=void 0,r.threshold>0&&(i.allowThresholdMove=!1),"touchstart"!==l.type){let t=!0;c.is(i.focusableElements)&&(t=!1),o.activeElement&&$(o.activeElement).is(i.focusableElements)&&o.activeElement!==c[0]&&o.activeElement.blur();const n=t&&e.allowTouchMove&&r.touchStartPreventDefault;!r.touchStartForcePreventDefault&&!n||c[0].isContentEditable||l.preventDefault()}e.emit("touchStart",l)}