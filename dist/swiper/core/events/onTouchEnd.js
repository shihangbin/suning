import{now,nextTick}from"../../shared/utils.js";export default function onTouchEnd(e){const i=this,o=i.touchEventsData,{params:t,touches:s,rtlTranslate:r,slidesGrid:l,enabled:n}=i;if(!n)return;let a=e;if(a.originalEvent&&(a=a.originalEvent),o.allowTouchCallbacks&&i.emit("touchEnd",a),o.allowTouchCallbacks=!1,!o.isTouched)return o.isMoved&&t.grabCursor&&i.setGrabCursor(!1),o.isMoved=!1,void(o.startMoving=!1);t.grabCursor&&o.isMoved&&o.isTouched&&(!0===i.allowSlideNext||!0===i.allowSlidePrev)&&i.setGrabCursor(!1);const d=now(),c=d-o.touchStartTime;if(i.allowClick){const e=a.path||a.composedPath&&a.composedPath();i.updateClickedSlide(e&&e[0]||a.target),i.emit("tap click",a),c<300&&d-o.lastClickTime<300&&i.emit("doubleTap doubleClick",a)}if(o.lastClickTime=now(),nextTick((()=>{i.destroyed||(i.allowClick=!0)})),!o.isTouched||!o.isMoved||!i.swipeDirection||0===s.diff||o.currentTranslate===o.startTranslate)return o.isTouched=!1,o.isMoved=!1,void(o.startMoving=!1);let u;if(o.isTouched=!1,o.isMoved=!1,o.startMoving=!1,u=t.followFinger?r?i.translate:-i.translate:-o.currentTranslate,t.cssMode)return;if(i.params.freeMode&&t.freeMode.enabled)return void i.freeMode.onTouchEnd({currentPos:u});let p=0,T=i.slidesSizesGrid[0];for(let e=0;e<l.length;e+=e<t.slidesPerGroupSkip?1:t.slidesPerGroup){const i=e<t.slidesPerGroupSkip-1?1:t.slidesPerGroup;void 0!==l[e+i]?u>=l[e]&&u<l[e+i]&&(p=e,T=l[e+i]-l[e]):u>=l[e]&&(p=e,T=l[l.length-1]-l[l.length-2])}const v=(u-l[p])/T,g=p<t.slidesPerGroupSkip-1?1:t.slidesPerGroup;if(c>t.longSwipesMs){if(!t.longSwipes)return void i.slideTo(i.activeIndex);"next"===i.swipeDirection&&(v>=t.longSwipesRatio?i.slideTo(p+g):i.slideTo(p)),"prev"===i.swipeDirection&&(v>1-t.longSwipesRatio?i.slideTo(p+g):i.slideTo(p))}else{if(!t.shortSwipes)return void i.slideTo(i.activeIndex);i.navigation&&(a.target===i.navigation.nextEl||a.target===i.navigation.prevEl)?a.target===i.navigation.nextEl?i.slideTo(p+g):i.slideTo(p):("next"===i.swipeDirection&&i.slideTo(p+g),"prev"===i.swipeDirection&&i.slideTo(p))}}