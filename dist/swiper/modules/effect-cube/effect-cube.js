import $ from"../../shared/dom.js";import effectInit from"../../shared/effect-init.js";export default function EffectCube({swiper:e,extendParams:s,on:t}){s({cubeEffect:{slideShadows:!0,shadow:!0,shadowOffset:20,shadowScale:.94}});effectInit({effect:"cube",swiper:e,on:t,setTranslate:()=>{const{$el:s,$wrapperEl:t,slides:a,width:i,height:o,rtlTranslate:r,size:d,browser:l}=e,n=e.params.cubeEffect,h=e.isHorizontal(),p=e.virtual&&e.params.virtual.enabled;let w,f=0;n.shadow&&(h?(w=t.find(".swiper-cube-shadow"),0===w.length&&(w=$('<div class="swiper-cube-shadow"></div>'),t.append(w)),w.css({height:`${i}px`})):(w=s.find(".swiper-cube-shadow"),0===w.length&&(w=$('<div class="swiper-cube-shadow"></div>'),s.append(w))));for(let e=0;e<a.length;e+=1){const s=a.eq(e);let t=e;p&&(t=parseInt(s.attr("data-swiper-slide-index"),10));let i=90*t,o=Math.floor(i/360);r&&(i=-i,o=Math.floor(-i/360));const l=Math.max(Math.min(s[0].progress,1),-1);let w=0,c=0,g=0;t%4==0?(w=4*-o*d,g=0):(t-1)%4==0?(w=0,g=4*-o*d):(t-2)%4==0?(w=d+4*o*d,g=d):(t-3)%4==0&&(w=-d,g=3*d+4*d*o),r&&(w=-w),h||(c=w,w=0);const m=`rotateX(${h?0:-i}deg) rotateY(${h?i:0}deg) translate3d(${w}px, ${c}px, ${g}px)`;if(l<=1&&l>-1&&(f=90*t+90*l,r&&(f=90*-t-90*l)),s.transform(m),n.slideShadows){let e=h?s.find(".swiper-slide-shadow-left"):s.find(".swiper-slide-shadow-top"),t=h?s.find(".swiper-slide-shadow-right"):s.find(".swiper-slide-shadow-bottom");0===e.length&&(e=$(`<div class="swiper-slide-shadow-${h?"left":"top"}"></div>`),s.append(e)),0===t.length&&(t=$(`<div class="swiper-slide-shadow-${h?"right":"bottom"}"></div>`),s.append(t)),e.length&&(e[0].style.opacity=Math.max(-l,0)),t.length&&(t[0].style.opacity=Math.max(l,0))}}if(t.css({"-webkit-transform-origin":`50% 50% -${d/2}px`,"transform-origin":`50% 50% -${d/2}px`}),n.shadow)if(h)w.transform(`translate3d(0px, ${i/2+n.shadowOffset}px, ${-i/2}px) rotateX(90deg) rotateZ(0deg) scale(${n.shadowScale})`);else{const e=Math.abs(f)-90*Math.floor(Math.abs(f)/90),s=1.5-(Math.sin(2*e*Math.PI/360)/2+Math.cos(2*e*Math.PI/360)/2),t=n.shadowScale,a=n.shadowScale/s,i=n.shadowOffset;w.transform(`scale3d(${t}, 1, ${a}) translate3d(0px, ${o/2+i}px, ${-o/2/a}px) rotateX(-90deg)`)}const c=l.isSafari||l.isWebView?-d/2:0;t.transform(`translate3d(0px,0,${c}px) rotateX(${e.isHorizontal()?0:f}deg) rotateY(${e.isHorizontal()?-f:0}deg)`)},setTransition:s=>{const{$el:t,slides:a}=e;a.transition(s).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(s),e.params.cubeEffect.shadow&&!e.isHorizontal()&&t.find(".swiper-cube-shadow").transition(s)},perspective:()=>!0,overwriteParams:()=>({slidesPerView:1,slidesPerGroup:1,watchSlidesProgress:!0,resistanceRatio:0,spaceBetween:0,centeredSlides:!1,virtualTranslate:!0})})}