import{isObject}from"../../shared/utils.js";import $ from"../../shared/dom.js";export default function Thumb({swiper:e,extendParams:s,on:i}){s({thumbs:{swiper:null,multipleActiveThumbs:!0,autoScrollOffset:0,slideThumbActiveClass:"swiper-slide-thumb-active",thumbsContainerClass:"swiper-thumbs"}});let a=!1,t=!1;function r(){const s=e.thumbs.swiper;if(!s)return;const i=s.clickedIndex,a=s.clickedSlide;if(a&&$(a).hasClass(e.params.thumbs.slideThumbActiveClass))return;if(null==i)return;let t;if(t=s.params.loop?parseInt($(s.clickedSlide).attr("data-swiper-slide-index"),10):i,e.params.loop){let s=e.activeIndex;e.slides.eq(s).hasClass(e.params.slideDuplicateClass)&&(e.loopFix(),e._clientLeft=e.$wrapperEl[0].clientLeft,s=e.activeIndex);const i=e.slides.eq(s).prevAll(`[data-swiper-slide-index="${t}"]`).eq(0).index(),a=e.slides.eq(s).nextAll(`[data-swiper-slide-index="${t}"]`).eq(0).index();t=void 0===i?a:void 0===a?i:a-s<s-i?a:i}e.slideTo(t)}function l(){const{thumbs:s}=e.params;if(a)return!1;a=!0;const i=e.constructor;if(s.swiper instanceof i)e.thumbs.swiper=s.swiper,Object.assign(e.thumbs.swiper.originalParams,{watchSlidesProgress:!0,slideToClickedSlide:!1}),Object.assign(e.thumbs.swiper.params,{watchSlidesProgress:!0,slideToClickedSlide:!1});else if(isObject(s.swiper)){const a=Object.assign({},s.swiper);Object.assign(a,{watchSlidesProgress:!0,slideToClickedSlide:!1}),e.thumbs.swiper=new i(a),t=!0}return e.thumbs.swiper.$el.addClass(e.params.thumbs.thumbsContainerClass),e.thumbs.swiper.on("tap",r),!0}function d(s){const i=e.thumbs.swiper;if(!i)return;const a="auto"===i.params.slidesPerView?i.slidesPerViewDynamic():i.params.slidesPerView,t=e.params.thumbs.autoScrollOffset,r=t&&!i.params.loop;if(e.realIndex!==i.realIndex||r){let l,d,n=i.activeIndex;if(i.params.loop){i.slides.eq(n).hasClass(i.params.slideDuplicateClass)&&(i.loopFix(),i._clientLeft=i.$wrapperEl[0].clientLeft,n=i.activeIndex);const s=i.slides.eq(n).prevAll(`[data-swiper-slide-index="${e.realIndex}"]`).eq(0).index(),a=i.slides.eq(n).nextAll(`[data-swiper-slide-index="${e.realIndex}"]`).eq(0).index();l=void 0===s?a:void 0===a?s:a-n==n-s?i.params.slidesPerGroup>1?a:n:a-n<n-s?a:s,d=e.activeIndex>e.previousIndex?"next":"prev"}else l=e.realIndex,d=l>e.previousIndex?"next":"prev";r&&(l+="next"===d?t:-1*t),i.visibleSlidesIndexes&&i.visibleSlidesIndexes.indexOf(l)<0&&(i.params.centeredSlides?l=l>n?l-Math.floor(a/2)+1:l+Math.floor(a/2)-1:l>n&&i.params.slidesPerGroup,i.slideTo(l,s?0:void 0))}let l=1;const d=e.params.thumbs.slideThumbActiveClass;if(e.params.slidesPerView>1&&!e.params.centeredSlides&&(l=e.params.slidesPerView),e.params.thumbs.multipleActiveThumbs||(l=1),l=Math.floor(l),i.slides.removeClass(d),i.params.loop||i.params.virtual&&i.params.virtual.enabled)for(let s=0;s<l;s+=1)i.$wrapperEl.children(`[data-swiper-slide-index="${e.realIndex+s}"]`).addClass(d);else for(let s=0;s<l;s+=1)i.slides.eq(e.realIndex+s).addClass(d)}e.thumbs={swiper:null},i("beforeInit",(()=>{const{thumbs:s}=e.params;s&&s.swiper&&(l(),d(!0))})),i("slideChange update resize observerUpdate",(()=>{e.thumbs.swiper&&d()})),i("setTransition",((s,i)=>{const a=e.thumbs.swiper;a&&a.setTransition(i)})),i("beforeDestroy",(()=>{const s=e.thumbs.swiper;s&&t&&s&&s.destroy()})),Object.assign(e.thumbs,{init:l,update:d})}