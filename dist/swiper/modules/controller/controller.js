import{nextTick}from"../../shared/utils.js";export default function Controller({swiper:t,extendParams:n,on:r}){function e(t,n){const r=function(){let t,n,r;return(e,o)=>{for(n=-1,t=e.length;t-n>1;)r=t+n>>1,e[r]<=o?n=r:t=r;return t}}();let e,o;return this.x=t,this.y=n,this.lastIndex=t.length-1,this.interpolate=function(t){return t?(o=r(this.x,t),e=o-1,(t-this.x[e])*(this.y[o]-this.y[e])/(this.x[o]-this.x[e])+this.y[e]):0},this}function o(){t.controller.control&&t.controller.spline&&(t.controller.spline=void 0,delete t.controller.spline)}n({controller:{control:void 0,inverse:!1,by:"slide"}}),t.controller={control:void 0},r("beforeInit",(()=>{t.controller.control=t.params.controller.control})),r("update",(()=>{o()})),r("resize",(()=>{o()})),r("observerUpdate",(()=>{o()})),r("setTranslate",((n,r,e)=>{t.controller.control&&t.controller.setTranslate(r,e)})),r("setTransition",((n,r,e)=>{t.controller.control&&t.controller.setTransition(r,e)})),Object.assign(t.controller,{setTranslate:function(n,r){const o=t.controller.control;let l,s;const i=t.constructor;function a(n){const r=t.rtlTranslate?-t.translate:t.translate;"slide"===t.params.controller.by&&(!function(n){t.controller.spline||(t.controller.spline=t.params.loop?new e(t.slidesGrid,n.slidesGrid):new e(t.snapGrid,n.snapGrid))}(n),s=-t.controller.spline.interpolate(-r)),s&&"container"!==t.params.controller.by||(l=(n.maxTranslate()-n.minTranslate())/(t.maxTranslate()-t.minTranslate()),s=(r-t.minTranslate())*l+n.minTranslate()),t.params.controller.inverse&&(s=n.maxTranslate()-s),n.updateProgress(s),n.setTranslate(s,t),n.updateActiveIndex(),n.updateSlidesClasses()}if(Array.isArray(o))for(let t=0;t<o.length;t+=1)o[t]!==r&&o[t]instanceof i&&a(o[t]);else o instanceof i&&r!==o&&a(o)},setTransition:function(n,r){const e=t.constructor,o=t.controller.control;let l;function s(r){r.setTransition(n,t),0!==n&&(r.transitionStart(),r.params.autoHeight&&nextTick((()=>{r.updateAutoHeight()})),r.$wrapperEl.transitionEnd((()=>{o&&(r.params.loop&&"slide"===t.params.controller.by&&r.loopFix(),r.transitionEnd())})))}if(Array.isArray(o))for(l=0;l<o.length;l+=1)o[l]!==r&&o[l]instanceof e&&s(o[l]);else o instanceof e&&r!==o&&s(o)}})}