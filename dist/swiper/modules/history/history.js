import{getWindow}from"ssr-window";export default function History({swiper:e,extendParams:t,on:a}){t({history:{enabled:!1,root:"",replaceState:!1,key:"slides"}});let s=!1,r={};const o=e=>e.toString().replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,""),i=e=>{const t=getWindow();let a;a=e?new URL(e):t.location;const s=a.pathname.slice(1).split("/").filter((e=>""!==e)),r=s.length;return{key:s[r-2],value:s[r-1]}},l=(t,a)=>{const r=getWindow();if(!s||!e.params.history.enabled)return;let i;i=e.params.url?new URL(e.params.url):r.location;const l=e.slides.eq(a);let n=o(l.attr("data-history"));if(e.params.history.root.length>0){let a=e.params.history.root;"/"===a[a.length-1]&&(a=a.slice(0,a.length-1)),n=`${a}/${t}/${n}`}else i.pathname.includes(t)||(n=`${t}/${n}`);const p=r.history.state;p&&p.value===n||(e.params.history.replaceState?r.history.replaceState({value:n},null,n):r.history.pushState({value:n},null,n))},n=(t,a,s)=>{if(a)for(let r=0,i=e.slides.length;r<i;r+=1){const i=e.slides.eq(r);if(o(i.attr("data-history"))===a&&!i.hasClass(e.params.slideDuplicateClass)){const a=i.index();e.slideTo(a,t,s)}}else e.slideTo(0,t,s)},p=()=>{r=i(e.params.url),n(e.params.speed,e.paths.value,!1)};a("init",(()=>{e.params.history.enabled&&(()=>{const t=getWindow();if(e.params.history){if(!t.history||!t.history.pushState)return e.params.history.enabled=!1,void(e.params.hashNavigation.enabled=!0);s=!0,r=i(e.params.url),(r.key||r.value)&&(n(0,r.value,e.params.runCallbacksOnInit),e.params.history.replaceState||t.addEventListener("popstate",p))}})()})),a("destroy",(()=>{e.params.history.enabled&&(()=>{const t=getWindow();e.params.history.replaceState||t.removeEventListener("popstate",p)})()})),a("transitionEnd _freeModeNoMomentumRelease",(()=>{s&&l(e.params.history.key,e.activeIndex)})),a("slideChange",(()=>{s&&e.params.cssMode&&l(e.params.history.key,e.activeIndex)}))}